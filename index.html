<!DOCTYPE html>
<html>

<head>
    <title>Calculator</title>
    <style>
        #calculatorDisplay {
            display: grid;
            grid-template-columns: auto;
            justify-items: stretch;
            width: 400px;
            height: 50px;
            margin: 0 auto;
            background-color: #5b9aa0;
            color: white;
        }

        #calculatorKeypad {
            display: grid;
            grid-template-columns: auto auto auto auto auto;
            justify-items: stretch;
            width: 400px;
            height: 400px;
            margin: 0 auto;
        }

        button {
            padding: 10px;
            margin: 10px;
        }

        .operations {
            background-color: #d6d4e0;
        }

        .displayable {
            background-color: #b8a9c9;
        }
    </style>
</head>

<body>
    <div id="calculator">
        <div id="calculatorDisplay">
            <div id="display"></div>
        </div>
        <div id="calculatorKeypad">
            <button data-key="7" class="displayable" id="7">7</button>
            <button data-key="8" class="displayable" id="8">8</button>
            <button data-key="9" class="displayable" id="9">9</button>
            <div id="space1"></div>
            <button data-key="c" class="operations" id="cancel">Cancel</button>
            <button data-key="4" class="displayable" id="4">4</button>
            <button data-key="5" class="displayable" id="5">5</button>
            <button data-key="6" class="displayable" id="6">6</button>
            <button data-key="*" class="operations" id="x">x</button>
            <button data-key="/" class="operations" id="/">/</button>
            <button data-key="1" class="displayable" id="1">1</button>
            <button data-key="2" class="displayable" id="2">2</button>
            <button data-key="3" class="displayable" id="3">3</button>
            <button data-key="+" class="operations" id="+">+</button>
            <button data-key="-" class="operations" id="-">-</button>
            <div id="space2"></div>
            <button data-key="0" class="displayable" id="0">0</button>
            <div id="space3"></div>
            <div id="space4"></div>
            <button data-key="=" class="operations" id="=">=</button>
        </div>
    </div>
    <script>
        window.addEventListener('keydown', function (e) {
            const btn = document.querySelector(`button[data-key="${e.key}"]`);
            if (!btn) { return; }
            if (btn.id === "cancel") {
                clearDisplay();
            } else if (btn.id === "=") { equalsOperation(); } else {
                addToDisplay(btn.id);
            }
        })

        function add(num1, num2) { solution = (parseInt(num1) + parseInt(num2)); }
        function subtract(num1, num2) { solution = (parseInt(num1) - parseInt(num2)); }
        function multiply(num1, num2) { solution = (parseInt(num1) * parseInt(num2)); }
        function divide(num1, num2) {
            if (num2 === "0") {
                alert("Can't divide by zero")
                clearDisplay();
            } else {
                solution = (parseInt(num1) / parseInt(num2));
            }
        }

        function operate(operator, num1, num2) {
            switch (operator) {
                case "+": add(num1, num2);
                    break;
                case "-": subtract(num1, num2);
                    break;
                case "x": multiply(num1, num2);
                    break;
                case "/": divide(num1, num2);
            }
        }

        let display = document.getElementById("display");
        let displayContent = "";
        let solution = 0;
        let digits = [];
        let operator;
        let num1;
        let num2;
        let operators = []
        let operands;

        function addToDisplay(element) {
            displayContent += element;
            display.innerHTML = displayContent;
        }

        function clearDisplay() {
            displayContent = "";
            display.innerHTML = displayContent;
            solution = 0;
        }

        const buttons = document.querySelectorAll("button")
        buttons.forEach((button) => {
            if (button.className === "displayable" || button.className === "operations") {
                button.addEventListener('click', (e) => {
                    addToDisplay(button.id);
                });
            }
        });

        let equalsButton = document.getElementById("=");
        equalsButton.addEventListener('click', (e) => {
            equalsOperation();
        })

        function equalsOperation() {
            if (displayContent[displayContent.length - 1] === "+" ||
                displayContent[displayContent.length - 1] === "-" ||
                displayContent[displayContent.length - 1] === "x" ||
                displayContent[displayContent.length - 1] === "/") {
                alert("Please finish expression");
            } else {
                findOperands(displayContent);
                findOperators(displayContent);
                findSolution();
                displaySolution();
            }
        }

        function findOperands(stringToCheck) {
            operands = stringToCheck.split(/[^0-9]/);
        }

        function findOperators(stringToCheck) {
            operators = stringToCheck.split(/[0-9]/).filter(v => v !== "");
        }

        let cancelButton = document.getElementById("cancel");
        cancelButton.addEventListener('click', (e) => {
            clearDisplay();
        });

        function findSolution() {
            while (operators.length != 0) {
                operate(operators[0], operands[0], operands[1]);
                operands.shift();
                operands.shift();
                operands.splice(0, 0, solution)
                operators.shift();
            }

        }

        function displaySolution() {
            displayContent = Math.round(solution * 10) / 10;
            display.innerHTML = displayContent;
        }

    </script>
</body>

</html>